



### 一、善后工作
1. 按照**公式、表、图形**的顺序检查，有无跨页
2. 更新目录（只更新页码）



### 杂碎
Visio：更多形状->常规->基本形状
              ->其他Visio方案->连接符

>（1）摘要：
>1.大的应用背景
2.小背景（研究现状，存在的问题）
3.主要工作内容
4.工作总结，未来方向，工作价值。

其中比较典型的有：
1）隐写容量过低：比如MP3Stego[2]、基于码率控制的AAC隐写[3]、基于STC编码的MP3频域隐写方法[4]。
2）隐写方案设计上过于启发式，缺乏理论依据：比如基于符号位数值修改的AAC音频隐写方法[5]、基于MDCT量化系数小值区的AAC隐写方法[6]、基于STC编码的AAC时域隐写方法[7]。

做好铺垫,奠定知识基础，提供理论依据,做好技术储备




from bitarray import bitarray
bit = str2bitarray(s)
str = bitarray2str(bit)

def str2bit(s):
    return ''.join([bin(ord(c)).replace('0b', '') for c in s])


def bit2str(s):
    return ''.join([chr(i) for i in [int(b, 2) for b in s.split(' ')]])


f = open('A:/秘密信息.txt', 'r')
msg = f.read()
bit_array_msg = str2bit(msg)
print(len(bit_array_msg))
f.close()

f = open('A:/extr_秘密信息.txt', 'w')
f.write(bit_array_msg)
f.close()

>流程：
open-cover(计算隐写容量cal_steganographic_capacity)
open-msg(比较消息长度和隐写容量大小)
win1-embed(开始嵌了：emb_STC)
win1-extract(extr_STC)





（1）实验评估中，自变量使用的是负载，这个概念不够直观。未来需要将这个概念和相对嵌入率（嵌入信息码率/载体AAC文件的码率）联系起来。
（2）音频样本采用的均为48 kHz采样率，不具备普适性。未来需要换成44.1 kHz的样本，寻找可以准确测量44.1 kHz样本音质的PEAQ工具。
（3）在输入码率参数缺省时，不同的隐写样本的码率在80 kpbs左右，没有统一。
（4）在工程实现上，做一千个隐写样本耗费时长约5小时，时间过长，需要优化，提高效率。
#码率
1. 96 kbps and 128 kbps: 20s 1575 44.1 kHz 16-bit  (IWDW)
2. 400 kbps:(AAC空域-STC)
3. 32 kbps: 10,000个 16 khz 


###检测率Pd（1000个）
payload\cost_func |STC-Xmin(proposed)|STC-TF
--|:--:|:--:|:--:|:--:|:--:|--
0.125| 0.8597 (+/- 0.0316) | 0.6775 (+/- 0.0202)
0.062| 0.8357 (+/- 0.0256) | 0.9017 (+/- 0.0080)
0.031| 0.9494 (+/- 0.0034) | 0.8978 (+/- 0.0055)
0.016| 0.9173 (+/- 0.0090) | 0.7786 (+/- 0.0056)
0.008| 0.7416 (+/- 0.0066) | 0.6225 (+/- 0.0084) 
0.004| 0.5952 (+/- 0.0074) | 0.5576 (+/- 0.0058)
0.002| 0.5327 (+/- 0.0057) | 0.5214 (+/- 0.0051)



##实验评估：
  1. 不可检测性
  2. 隐写容量
  a. 负载：α = m / n，m是秘密消息的比特数，n是音频载体中Qmdct总个数。 （2018-AHCM中定义RER，含义近似。AAC空域-STC用了α=0.1 0.3 0.5）
  b. 嵌入率(ER) = n / N,其中N是音频帧的数目,n是用于嵌入消息的帧的数目。（用ER显得数值很大。2017-EECS用的是这个）
  c. 一个颗粒（576个系数）最多嵌入10比特。换算成α=1.7％（MP3频域-STC）（**对比**）

  3. 不可感知性（PEAQ、信噪比）
  PEAQ是ITU-R提出的感知音频质量评价(PEAQ)模型。PEAQ模型将参考信号(原始音频信号)和失真信号 (隐写后的音频信号)通过心理声学模型模拟人耳对音频信号的感知，最终得到客观失真等级(ODG)：ODG最高为0，表示没有失真，最低为-4，表示失真很大。 In this experiment, the reference audio is the WAV decompressed from cover MP3 and the test audio is the WAV decompressed from stego MP3. （来自EECS） 


1835
3670
7340
7340×8 / 863×2×1024 ≈ 3.3％
设payload=m/n，m是秘密消息比特数，n是载体中Qmdct总个数。



1. 竖向对比：ODG，Pd都符合规律。（除了-0.6242、0.8100）
2. 横向对比：
对于ODG，在列举的嵌入率情况下，Tf表现都比Xmin好。
随着嵌入率降低，ODG值增大的速度放缓。在1/512甚至更低嵌入率下，Xmin和Tf方法效果相当。

对于Pd，1/128嵌入率下，Xmin表现更好（0.6900 ＜ 0.8100）；其他情况，Tf表现更好。



1. 绝对值/平方
```
	for (sb = 0; sb < coderInfo->nr_of_sfb; sb++)
	{
		 invQuantFac = pow(2.0, -0.25*(coderInfo->scale_factor[sb] - coderInfo->global_gain));
		 start = coderInfo->sfb_offset[sb];
		 end = coderInfo->sfb_offset[sb + 1];

		for (i = start; i < end; i++)
		{
			if (xi[i] == 0){
				fprintf(fp, "%d\tInf\tInf\n", xi[i]);
			}

			else {
				sign = (xr[i] < 0) ? -1 : 1;

				requant_xr[i] = sign * pow43[abs(xi[i] - 1)] * invQuantFac;
				cost = pow(fabs(xr[i] - requant_xr[i]), 2.0);     // cost of changing pixel by -1				
				costs[2 * i + 0] = (cost >= FLT_MAX) ? FLT_MAX : cost;

				//printf("\n%f", xr[i]-requant_xr[i]);

				requant_xr[i] = sign * pow43[abs(xi[i] + 1)] * invQuantFac;
				cost = pow(fabs(xr[i] - requant_xr[i]), 2.0);      // cost of changing pixel by +1
				costs[2 * i + 1] = (cost >= FLT_MAX) ? FLT_MAX : cost;

				fprintf(fp, "%d\t%f\t%f\n", xi[i], costs[2 * i + 0], costs[2 * i + 1]);
			}
		}
	}
```
2. xmin分情况：
```
//*
	for (sb = 0; sb < coderInfo->nr_of_sfb; sb++)
	{
		invQuantFac = pow(2.0, -0.25*(coderInfo->scale_factor[sb] - coderInfo->global_gain));
		start = coderInfo->sfb_offset[sb];
		end = coderInfo->sfb_offset[sb + 1];

		for (i = start; i < end; i++)
		{
			if (xi[i] == 0){
				fprintf(fp, "%d\tInf\tInf\n", xi[i]);
			}

			else {
				diffvol = 0.0;//-1
				for (j = start; j < end; j++)
				{
					if (j == i)		xi[j] -= 1;

					tmp = xi[j];
					diffvol += tmp * tmp;
				}
				if (diffvol < 1e-6)		diffvol = 1e-6;
				tmp = pow(diffvol / (double)(end - start), -0.666);

				if (tmp > xmin[sb])
				{
					sign = (xr[i] < 0) ? -1 : 1;
					requant_xr[i] = sign * pow43[abs(xi[i] - 1)] * invQuantFac;
					cost = pow(fabs(xr[i] - requant_xr[i]), 2.0);     // cost of changing pixel by -1				
					costs[2 * i + 0] = (cost >= FLT_MAX) ? FLT_MAX : cost;
				}
				else{
					costs[2 * i + 0] = 0.01;
				}//-1

				diffvol = 0.0;//+1
				for (j = start; j < end; j++)
				{
					if (j == i)		xi[j] += 1;

					tmp = xi[j];
					diffvol += tmp * tmp;
				}
				if (diffvol < 1e-6)		diffvol = 1e-6;
				tmp = pow(diffvol / (double)(end - start), -0.666);

				if (tmp > xmin[sb])
				{
					sign = (xr[i] < 0) ? -1 : 1;
					requant_xr[i] = sign * pow43[abs(xi[i] + 1)] * invQuantFac;
					cost = pow(fabs(xr[i] - requant_xr[i]), 2.0);     // cost of changing pixel by +1				
					costs[2 * i + 1] = (cost >= FLT_MAX) ? FLT_MAX : cost;
				}
				else{
					costs[2 * i + 1] = 0.01;
				}//+1								
				fprintf(fp, "%d\t%f\t%f\n", xi[i], costs[2 * i + 0], costs[2 * i + 1]);
			}
		}
	}
	//*/
```

3. Tf （去掉平方 测）
```
/*
	for (sb = 0; sb < coderInfo->nr_of_sfb; sb++)
	{
		start = coderInfo->sfb_offset[sb];
		end = coderInfo->sfb_offset[sb + 1];

		for (j = start; j < end; j++)
		{
			if (xi[j] != 0)	break;
		}

		if (j == end)
		{
			for (j = start; j < end; j++)
				fprintf(fp, "%d\tInf\tInf\n", xi[j]);
		}
		else{
			for (j = start; j < end; j++)
			{
				f[j] = (j + 1)*(44.1 / 1024);
				T[j] = 3.64*pow(f[j], -0.8) - 6.5*exp(-0.6*(f[j] - 3.3)*(f[j] - 3.3)) + 0.001*pow(f[j], 4);
				log = log10(T[j] + 6); //原本是log2
				cost = pow(1 / log, 2.0); //原本没有平方

				fprintf(fp, "%d\t%f\t%f\n", xi[j], cost, cost);
			}
		}

	}//*/
```


## 关键词：
MP3 AAC audio
adaptive steganography
psychoacoustic
distortion
STC


+ 反量化
x_rescal=x_invquant*gain
x_invquant=sign(x_quant)*|x_quant|^(4/3)
gain=2^(0.25*(sf–SF_OFFSET))
SF_OFFSET=100

