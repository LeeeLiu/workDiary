
### 资料
1. 官网、群。

### 过程
1. 免费账号：在线填写申请表，收到管理员邮件(获得登录名、初始随机密码)
2. 付费账号：填写电子表格，导师签字，扫描，发送至超算邮箱。自己的账户关联到老师账户名下。
3. 提交作业：
    - `srun`命令： srun提交的程序处于处于交互模式下。人工退出（如Ctrl+c、终端关闭等）或因登录节点故障退出时，程序运行节点的程序`也会退出`。
        + `srun -p hpxg ./a.out`
    - `sbatch`命令： 当进程不需要人工干预时，可以使用sbatch来进行任务的提交，这样无论是终端退出或登录节点故障都`不会影响`到我们实际运行的程序。
        + `chmod +x mybash.sh`
        + `sbatch –p hpxg echo.sh`

4. 取消作业    
    - srun提交的任务，ctl+c取消了你的全部任务。
    - sbatch提交: `scancel username`取消了你的全部任务、`scancel jobid`取消某个任务



6. 查看任务
`sacct`查看已经结束的任务历史
`squeue`查看正在运行的任务

7. 查看可用环境
`module avail`


### 提交GPU作业
1. sh文件
    - 版本1
        ```
        #!/bin/bash
        
        # 这里加载的是预置环境（可用module avail查询）。
        #module load anaconda/3.7
        #module load pytorch/1.0_python3.7_gpu
        module load  nvidia/cuda/10.1

        ## 这里必须进入main_experiment.py所在的目录下
        cd    $SLURM_SUBMIT_DIR  ##（不需赋值）
        python main_experiment.py  
        ```
    - 版本2
        ```
        #!/bin/bash

        ## 这里前提是，在登录节点上已经激活了conda虚拟环境
        module load nvidia/cuda/10.1

        cd    $SLURM_SUBMIT_DIR
        python experiment.py
        ```

2. sbatch指令。cd到py程序所在的目录下，.sh文件也放在这个目录下。输入下面的指令：
`sbatch --account=yzren --partition=gpu  --gres=gpu:2  --nodes=1  --time=72:00:00  coding_exp.sh`


### 环境
1. 自定义目录安装
`sh Anaconda3-2019.10-Linux-x86_64.sh`
2. 添加路径，使得conda命令可用
`vim ~/.bashrc`
`export PATH=$PATH:/dat01/liuting/env`
`source ~/.bashrc`
3. 在登录节点激活环境，sbatch提交作业即可



### 注意事项
1. 编译、安装，都可在登录节点上做。
2. 禁止在登录节点做计算执行操作，否则会被封号。
3. 登录节点可联网，计算节点不可联网。
4. 安装py包，要么自己重新安装python，要么使用conda虚拟环境。
